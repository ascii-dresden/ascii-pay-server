<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1281px" preserveAspectRatio="none" style="width:636px;height:1281px;background:#FFFFFF;" version="1.1" viewBox="0 0 636 1281" width="636px" zoomAndPan="magnify"><defs><filter height="300%" id="f18id77zqcv7kp" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="81" x="275.5" y="29.4023">NFC Flow</text><rect fill="#FFFFFF" filter="url(#f18id77zqcv7kp)" height="660.0313" style="stroke:#000000;stroke-width:2.0;" width="612" x="10" y="252.2402"/><rect fill="#FFFFFF" height="44.2656" style="stroke:none;stroke-width:1.0;" width="612" x="10" y="298.8613"/><rect fill="#FFFFFF" height="44.2656" style="stroke:none;stroke-width:1.0;" width="612" x="10" y="343.127"/><rect fill="#FFFFFF" height="203.8184" style="stroke:none;stroke-width:1.0;" width="612" x="10" y="387.3926"/><rect fill="#FFFFFF" height="321.0605" style="stroke:none;stroke-width:1.0;" width="612" x="10" y="591.2109"/><rect fill="#FFFFFF" filter="url(#f18id77zqcv7kp)" height="294.7051" style="stroke:#000000;stroke-width:2.0;" width="612" x="10" y="926.2715"/><rect fill="#FFFFFF" height="44.2656" style="stroke:none;stroke-width:1.0;" width="612" x="10" y="972.8926"/><rect fill="#FFFFFF" height="203.8184" style="stroke:none;stroke-width:1.0;" width="612" x="10" y="1017.1582"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="45" x2="45" y1="75.6875" y2="1237.9766"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="207" x2="207" y1="75.6875" y2="1237.9766"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="581" x2="581" y1="75.6875" y2="1237.9766"/><rect fill="#FEFECE" filter="url(#f18id77zqcv7kp)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="47" x="20" y="40.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="27" y="60.7344">Card</text><rect fill="#FEFECE" filter="url(#f18id77zqcv7kp)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="47" x="20" y="1236.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="27" y="1257.5117">Card</text><rect fill="#FEFECE" filter="url(#f18id77zqcv7kp)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="53" x="179" y="40.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="186" y="60.7344">Proxy</text><rect fill="#FEFECE" filter="url(#f18id77zqcv7kp)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="53" x="179" y="1236.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="186" y="1257.5117">Proxy</text><rect fill="#FEFECE" filter="url(#f18id77zqcv7kp)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="57" x="551" y="40.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="558" y="60.7344">Server</text><rect fill="#FEFECE" filter="url(#f18id77zqcv7kp)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="57" x="551" y="1236.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="558" y="1257.5117">Server</text><polygon fill="#A80036" points="56.5,102.998,46.5,106.998,56.5,110.998,52.5,106.998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="50.5" x2="206.5" y1="106.998" y2="106.998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="62.5" y="102.2559">Request identification</text><polygon fill="#A80036" points="195.5,132.3086,205.5,136.3086,195.5,140.3086,199.5,136.3086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="45.5" x2="201.5" y1="136.3086" y2="136.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="52.5" y="131.5664">Respond(atr)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="249.5" y1="165.6191" y2="165.6191"/><line style="stroke:#A80036;stroke-width:1.0;" x1="249.5" x2="249.5" y1="165.6191" y2="178.6191"/><line style="stroke:#A80036;stroke-width:1.0;" x1="208.5" x2="249.5" y1="178.6191" y2="178.6191"/><polygon fill="#A80036" points="218.5,174.6191,208.5,178.6191,218.5,182.6191,214.5,178.6191" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="214.5" y="160.877">Select card handler</text><polygon fill="#A80036" points="56.5,203.9297,46.5,207.9297,56.5,211.9297,52.5,207.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="50.5" x2="206.5" y1="207.9297" y2="207.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="62.5" y="203.1875">Request card id</text><polygon fill="#A80036" points="195.5,233.2402,205.5,237.2402,195.5,241.2402,199.5,237.2402" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="45.5" x2="201.5" y1="237.2402" y2="237.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="52.5" y="232.498">Respond(id)</text><path d="M10,252.2402 L155,252.2402 L155,259.2402 L145,269.2402 L10,269.2402 L10,252.2402 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="660.0313" style="stroke:#000000;stroke-width:2.0;" width="612" x="10" y="252.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="100" x="25" y="265.8086">Authentication</text><polygon fill="#A80036" points="569.5,286.8613,579.5,290.8613,569.5,294.8613,573.5,290.8613" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="575.5" y1="290.8613" y2="290.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="214.5" y="286.1191">Request authentication(id)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="622" y1="299.8613" y2="299.8613"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="15" y="310.4961">[NotFound]</text><polygon fill="#A80036" points="218.5,331.127,208.5,335.127,218.5,339.127,214.5,335.127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="335.127" y2="335.127"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="224.5" y="330.3848">Respond NotFound</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="622" y1="344.127" y2="344.127"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="53" x="15" y="354.7617">[Account]</text><polygon fill="#A80036" points="218.5,375.3926,208.5,379.3926,218.5,383.3926,214.5,379.3926" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="379.3926" y2="379.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="224.5" y="374.6504">Respond Account(Account)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="622" y1="388.3926" y2="388.3926"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="129" x="15" y="399.0273">[AuthenticationNeeded]</text><polygon fill="#A80036" points="218.5,419.6582,208.5,423.6582,218.5,427.6582,214.5,423.6582" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="423.6582" y2="423.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="224.5" y="418.916">Respond AuthenticationNeeded(key, challenge)</text><polygon fill="#A80036" points="56.5,448.9688,46.5,452.9688,56.5,456.9688,52.5,452.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="50.5" x2="206.5" y1="452.9688" y2="452.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="62.5" y="448.2266">Request Secret(key)</text><polygon fill="#A80036" points="195.5,478.2793,205.5,482.2793,195.5,486.2793,199.5,482.2793" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="45.5" x2="201.5" y1="482.2793" y2="482.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="52.5" y="477.5371">Respond(Secret)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="249.5" y1="511.5898" y2="511.5898"/><line style="stroke:#A80036;stroke-width:1.0;" x1="249.5" x2="249.5" y1="511.5898" y2="524.5898"/><line style="stroke:#A80036;stroke-width:1.0;" x1="208.5" x2="249.5" y1="524.5898" y2="524.5898"/><polygon fill="#A80036" points="218.5,520.5898,208.5,524.5898,218.5,528.5898,214.5,524.5898" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="214.5" y="506.8477">Calculate Challenge Response</text><polygon fill="#A80036" points="569.5,549.9004,579.5,553.9004,569.5,557.9004,573.5,553.9004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="575.5" y1="553.9004" y2="553.9004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="214.5" y="549.1582">Request authentication(id, challange-reponse)</text><polygon fill="#A80036" points="218.5,579.2109,208.5,583.2109,218.5,587.2109,214.5,583.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="583.2109" y2="583.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="224.5" y="578.4688">Respond Account(Account)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="622" y1="592.2109" y2="592.2109"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="57" x="15" y="602.8457">[WriteKey]</text><polygon fill="#A80036" points="218.5,623.4766,208.5,627.4766,218.5,631.4766,214.5,627.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="627.4766" y2="627.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="224.5" y="622.7344">Respond WriteKey(key, secret)</text><polygon fill="#A80036" points="56.5,652.7871,46.5,656.7871,56.5,660.7871,52.5,656.7871" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="50.5" x2="206.5" y1="656.7871" y2="656.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="62.5" y="652.0449">Store Secret(key)</text><polygon fill="#A80036" points="195.5,682.0977,205.5,686.0977,195.5,690.0977,199.5,686.0977" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="45.5" x2="201.5" y1="686.0977" y2="686.0977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="52.5" y="681.3555">Respond Ok</text><polygon fill="#A80036" points="569.5,711.4082,579.5,715.4082,569.5,719.4082,573.5,715.4082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="575.5" y1="715.4082" y2="715.4082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="214.5" y="710.666">Request authentication(id)</text><polygon fill="#A80036" points="218.5,740.7188,208.5,744.7188,218.5,748.7188,214.5,744.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="744.7188" y2="744.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="224.5" y="739.9766">Respond AuthenticationNeeded(key, challenge)</text><polygon fill="#A80036" points="56.5,770.0293,46.5,774.0293,56.5,778.0293,52.5,774.0293" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="50.5" x2="206.5" y1="774.0293" y2="774.0293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="62.5" y="769.2871">Request Secret(key)</text><polygon fill="#A80036" points="195.5,799.3398,205.5,803.3398,195.5,807.3398,199.5,803.3398" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="45.5" x2="201.5" y1="803.3398" y2="803.3398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="52.5" y="798.5977">Respond(Secret)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="249.5" y1="832.6504" y2="832.6504"/><line style="stroke:#A80036;stroke-width:1.0;" x1="249.5" x2="249.5" y1="832.6504" y2="845.6504"/><line style="stroke:#A80036;stroke-width:1.0;" x1="208.5" x2="249.5" y1="845.6504" y2="845.6504"/><polygon fill="#A80036" points="218.5,841.6504,208.5,845.6504,218.5,849.6504,214.5,845.6504" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="214.5" y="827.9082">Calculate Challenge Response</text><polygon fill="#A80036" points="569.5,870.9609,579.5,874.9609,569.5,878.9609,573.5,874.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="575.5" y1="874.9609" y2="874.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="214.5" y="870.2188">Request authentication(id, challange-reponse)</text><polygon fill="#A80036" points="218.5,900.2715,208.5,904.2715,218.5,908.2715,214.5,904.2715" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="904.2715" y2="904.2715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="224.5" y="899.5293">Respond Account(Account)</text><path d="M10,926.2715 L114,926.2715 L114,933.2715 L104,943.2715 L10,943.2715 L10,926.2715 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="294.7051" style="stroke:#000000;stroke-width:2.0;" width="612" x="10" y="926.2715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="25" y="939.8398">Payment</text><polygon fill="#A80036" points="569.5,960.8926,579.5,964.8926,569.5,968.8926,573.5,964.8926" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="575.5" y1="964.8926" y2="964.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="214.5" y="960.1504">Request payment token(id, amount)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="622" y1="973.8926" y2="973.8926"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="69" x="15" y="984.5273">[Authorized]</text><polygon fill="#A80036" points="218.5,1005.1582,208.5,1009.1582,218.5,1013.1582,214.5,1009.1582" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="1009.1582" y2="1009.1582"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="224.5" y="1004.416">Respond Authorized(token)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="622" y1="1018.1582" y2="1018.1582"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="129" x="15" y="1028.793">[AuthenticationNeeded]</text><polygon fill="#A80036" points="218.5,1049.4238,208.5,1053.4238,218.5,1057.4238,214.5,1053.4238" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="1053.4238" y2="1053.4238"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="224.5" y="1048.6816">Respond AuthenticationNeeded(key, challenge)</text><polygon fill="#A80036" points="56.5,1078.7344,46.5,1082.7344,56.5,1086.7344,52.5,1082.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="50.5" x2="206.5" y1="1082.7344" y2="1082.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="62.5" y="1077.9922">Request Secret(key)</text><polygon fill="#A80036" points="195.5,1108.0449,205.5,1112.0449,195.5,1116.0449,199.5,1112.0449" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="45.5" x2="201.5" y1="1112.0449" y2="1112.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="52.5" y="1107.3027">Respond(Secret)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="249.5" y1="1141.3555" y2="1141.3555"/><line style="stroke:#A80036;stroke-width:1.0;" x1="249.5" x2="249.5" y1="1141.3555" y2="1154.3555"/><line style="stroke:#A80036;stroke-width:1.0;" x1="208.5" x2="249.5" y1="1154.3555" y2="1154.3555"/><polygon fill="#A80036" points="218.5,1150.3555,208.5,1154.3555,218.5,1158.3555,214.5,1154.3555" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="214.5" y="1136.6133">Calculate Challenge Response</text><polygon fill="#A80036" points="569.5,1179.666,579.5,1183.666,569.5,1187.666,573.5,1183.666" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="207.5" x2="575.5" y1="1183.666" y2="1183.666"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="214.5" y="1178.9238">Request payment token(id, challange-reponse, amount)</text><polygon fill="#A80036" points="218.5,1208.9766,208.5,1212.9766,218.5,1216.9766,214.5,1212.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="212.5" x2="580.5" y1="1212.9766" y2="1212.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="224.5" y="1208.2344">Respond Authorized(token)</text><!--MD5=[3e21463a9c61957e8990db7abc02180b]
@startuml

title NFC Flow

Card <- Proxy: Request identification
Card -> Proxy: Respond(atr)

Proxy -> Proxy: Select card handler

Card <- Proxy: Request card id
Card -> Proxy: Respond(id)

group Authentication

Proxy -> Server: Request authentication(id)

else NotFound
Proxy <- Server: Respond NotFound

else Account 
Proxy <- Server: Respond Account(Account)

else AuthenticationNeeded
Proxy <- Server: Respond AuthenticationNeeded(key, challenge)
Card <- Proxy: Request Secret(key)
Card -> Proxy: Respond(Secret)

Proxy -> Proxy: Calculate Challenge Response
Proxy -> Server: Request authentication(id, challange-reponse)
Proxy <- Server: Respond Account(Account)

else WriteKey
Proxy <- Server: Respond WriteKey(key, secret)
Card <- Proxy: Store Secret(key)
Card -> Proxy: Respond Ok

Proxy -> Server: Request authentication(id)
Proxy <- Server: Respond AuthenticationNeeded(key, challenge)
Card <- Proxy: Request Secret(key)
Card -> Proxy: Respond(Secret)

Proxy -> Proxy: Calculate Challenge Response
Proxy -> Server: Request authentication(id, challange-reponse)
Proxy <- Server: Respond Account(Account)

end


group Payment

Proxy -> Server: Request payment token(id, amount)

else Authorized
Proxy <- Server: Respond Authorized(token)

else AuthenticationNeeded
Proxy <- Server: Respond AuthenticationNeeded(key, challenge)
Card <- Proxy: Request Secret(key)
Card -> Proxy: Respond(Secret)

Proxy -> Proxy: Calculate Challenge Response
Proxy -> Server: Request payment token(id, challange-reponse, amount)
Proxy <- Server: Respond Authorized(token)

end

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>